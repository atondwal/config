#!/bin/bash
# Enhanced history logging function for interactive shell
# Based on shawnghu's setup

function log_enhanced_history() {
    # Get the last command from history
    local last_cmd=$(history 1 | sed 's/^[ ]*[0-9]*[ ]*//')
    
    # Skip if empty or if it's the same as the previous logged command
    [[ -z "$last_cmd" ]] && return
    
    # Get context information
    local timestamp=$(date '+%Y%m%d %H:%M:%S')
    local username=${USER:-unknown}
    local hostname=$(hostname)
    local current_dir=$(pwd)
    
    # Append to standard history (clean for C-r)
    echo "$last_cmd" >> ~/.bash_history
    
    # Append to extended history with context
    echo "# $timestamp $username@$hostname:$current_dir" >> ~/.bash_extended_history
    echo "$last_cmd" >> ~/.bash_extended_history
}

# History configuration for enhanced logging
export HISTFILESIZE=
export HISTSIZE=
export HISTCONTROL=ignoredups:ignorespace
export HISTTIMEFORMAT='%Y%m%d %H:%M:%S '

# Set up the prompt command
export PROMPT_COMMAND='log_enhanced_history'