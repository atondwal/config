#!/bin/zsh
# Enhanced history logging function for zsh
# Based on shawnghu's setup

function log_enhanced_history() {
    # Get the last command from history
    local last_cmd=$(fc -ln -1)
    
    # Skip if empty
    [[ -z "$last_cmd" ]] && return
    
    # Get context information
    local timestamp=$(date '+%Y%m%d %H:%M:%S')
    local username=${USER:-unknown}
    local hostname=$(hostname)
    local current_dir=$(pwd)
    
    # Only append to extended history with context
    # Let zsh handle its own .zsh_history normally
    echo "# $timestamp $username@$hostname:$current_dir" >> ~/.zsh_extended_history
    echo "$last_cmd" >> ~/.zsh_extended_history
}

# Zsh history configuration for enhanced logging
export HISTFILE=~/.zsh_history
export HISTSIZE=50000
export SAVEHIST=50000
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE
setopt EXTENDED_HISTORY
setopt SHARE_HISTORY
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY

# Use precmd_functions to avoid conflicts with existing precmd function
# This works alongside your existing precmd() function
precmd_functions+=(log_enhanced_history)